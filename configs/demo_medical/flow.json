{
    "version": "1.0",
    "states": {
        "MENU": {
            "type": "text",
            "body": "Hola {{name}} ðŸ‘‹ bienvenido a *ClÃ­nica Demo Flowly*.\n\nAguarda un instante, estoy verificando si sos paciente...",
            "on_text_next": "ROUTER_CRM"
        },
        "ROUTER_CRM": {
            "type": "interactive_buttons",
            "action": "mock_crm_lookup",
            "body": "Sistema: VerificaciÃ³n completada.\nResultado: Â¿Es cliente? {{is_client}}\nNombre registrado: {{client_name}}\n\n(Este mensaje es interno para debug, ahora derivamos al usuario)",
            "buttons": {
                "footer": "Debug Mode",
                "buttons": [
                    {
                        "id": "NEXT",
                        "title": "Continuar"
                    }
                ]
            },
            "on_select_next": {
                "NEXT": "WELCOME_LOGIC"
            }
        },
        "WELCOME_LOGIC": {
            "type": "interactive_buttons",
            "body": "Hola de nuevo {{client_name}}. Â¿En quÃ© te podemos ayudar hoy?",
            "buttons": {
                "footer": "SeleccionÃ¡ una opciÃ³n",
                "buttons": [
                    {
                        "id": "AGENDAR",
                        "title": "ðŸ“… Nuevo Turno"
                    },
                    {
                        "id": "URGENCIA",
                        "title": "ðŸš¨ Urgencia"
                    }
                ]
            },
            "on_select_next": {
                "AGENDAR": "SELECT_DATE",
                "URGENCIA": "HUMAN_HANDOFF"
            }
        },
        "SELECT_DATE": {
            "type": "interactive_list",
            "action": "get_calendar_slots",
            "body": "Perfecto, estos son los turnos disponibles traÃ­dos de Google Calendar (Simulado):",
            "list": {
                "header": "Agenda",
                "footer": "Horarios disponibles",
                "button_text": "Ver horarios",
                "sections": [
                    {
                        "title": "PrÃ³ximos turnos",
                        "rows": [
                            {
                                "id": "SLOT_1",
                                "title": "OpciÃ³n 1",
                                "description": "{{slot_1}}"
                            },
                            {
                                "id": "SLOT_2",
                                "title": "OpciÃ³n 2",
                                "description": "{{slot_2}}"
                            },
                            {
                                "id": "SLOT_3",
                                "title": "OpciÃ³n 3",
                                "description": "{{slot_3}}"
                            }
                        ]
                    }
                ]
            },
            "on_select_next": {
                "SLOT_1": "CONFIRM_APPOINTMENT",
                "SLOT_2": "CONFIRM_APPOINTMENT",
                "SLOT_3": "CONFIRM_APPOINTMENT"
            }
        },
        "CONFIRM_APPOINTMENT": {
            "type": "text",
            "action": "schedule_appointment",
            "body": "âœ… Â¡Listo! Turno confirmado.\n\nPaciente: {{name}}\nFecha (ISO): {{appointment_confirm_time}}\n\nTe llegarÃ¡ la invitaciÃ³n de Google Calendar a tu email si lo tenemos, o un recordatorio por acÃ¡.",
            "on_text_next": "END"
        },
        "HUMAN_HANDOFF": {
            "type": "text",
            "body": "Entendido. Estoy derivando tu caso a un agente humano ðŸ‘¤.\n\nUn asesor te escribirÃ¡ desde este mismo chat en breve.",
            "on_text_next": "END"
        },
        "END": {
            "type": "text",
            "body": "Gracias por usar la demo de Flowly."
        }
    }
}